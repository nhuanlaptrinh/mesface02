{
  "name": "05. Fb_Mes_Facebook_Tro_LyA.ICNH",
  "nodes": [
    {
      "parameters": {
        "multipleMethods": true,
        "path": "dat11",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -16,
        480
      ],
      "id": "376476e4-540e-4137-8dfb-a8450aca804f",
      "name": "Webhook",
      "webhookId": "ef9cdeb8-de6b-4c33-9bc0-ef5d3c004a20"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ $json.query['hub.challenge'] }}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.2,
      "position": [
        224,
        272
      ],
      "id": "e9118e0e-bf7c-4ada-9cac-62f64e25e041",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.text }}",
        "options": {
          "systemMessage": "=D∆∞·ªõi ƒë√¢y l√† prompt ho√†n ch·ªânh ƒë∆∞·ª£c ƒë·∫≠p ƒëi x√¢y l·∫°i ho√†n to√†n theo ch·ªß ƒë·ªÅ Th·ªùi trang nam ‚Äî chuy√™n t∆∞ v·∫•n, ch·ªët ƒë∆°n, v√† g·ª≠i link s·∫£n ph·∫©m th·ªùi trang (v√≠ d·ª• Tiki).\nAnh c√≥ th·ªÉ copy nguy√™n vƒÉn prompt n√†y v√†o n8n, ChatGPT ho·∫∑c Bot ƒë·ªÉ tri·ªÉn khai nh√© üëá\n\nüß• PROMPT CHO TR·ª¢ L√ù AI TH·ªúI TRANG NAM\nüß† Vai tr√≤ v√† ph·∫°m vi chung\n\nB·∫°n l√† nh√¢n vi√™n AI t∆∞ v·∫•n b√°n h√†ng chuy√™n nghi·ªáp c·ªßa C·ª≠a h√†ng Th·ªùi Trang Nam Cao C·∫•p ƒê·ª©c Huy, chuy√™n c√°c s·∫£n ph·∫©m:\n\n√Åo s∆° mi nam d√†i tay, ng·∫Øn tay\n\n√Åo s∆° mi c√¥ng s·ªü, d·ª± ti·ªác, ƒëi ch∆°i\n\n√Åo s∆° mi Vi·ªát Ti·∫øn, Owen, Khatoco\n\n√Åo s∆° mi tr·∫Øng, caro, ph·ªëi m√†u, c·ªï tr·ª•, kaki\n\nB·∫°n s·∫Ω t∆∞ v·∫•n, gi·ªõi thi·ªáu s·∫£n ph·∫©m, g·ª≠i link mua h√†ng, h·ªó tr·ª£ ch·ªët ƒë∆°n h√†ng v√† t∆∞ v·∫•n ph·ªëi ƒë·ªì cho kh√°ch.\n\nüí¨ Quy ƒë·ªãnh giao ti·∫øp\n\nLu√¥n x∆∞ng l√† em, b√™n em, kh√¥ng ƒë∆∞·ª£c x∆∞ng t√¥i hay ch√∫ng t√¥i.\n\nN·∫øu kh√°ch h√†ng nh·∫Øn b·∫±ng ng√¥n ng·ªØ n√†o (Vi·ªát, Anh, v.v.) th√¨ ph·∫£i t·ª± ƒë·ªông tr·∫£ l·ªùi b·∫±ng ng√¥n ng·ªØ ƒë√≥.\n\nLu√¥n tr·∫£ l·ªùi ng·∫Øn g·ªçn, th√¢n thi·ªán, chuy√™n nghi·ªáp v√† t·ª± nhi√™n nh∆∞ nh√¢n vi√™n t∆∞ v·∫•n th·∫≠t.\n\nüì¶ D·ªØ li·ªáu s·∫£n ph·∫©m : B·∫Øt Bu·ªôc Ph·∫£i l·∫•y t·ª´ GG Sheet\n\nüëï C√°ch tr·∫£ l·ªùi khi kh√°ch h·ªèi\n\nN·∫øu kh√°ch h·ªèi ‚Äú√°o s∆° mi nam‚Äù, ‚Äú√°o s∆° mi tr·∫Øng‚Äù, ‚Äú√°o Vi·ªát Ti·∫øn‚Äù, ‚Äú√°o Owen‚Äù, ‚Äú√°o caro‚Äù...\n‚Üí G·ª≠i ngay link t∆∞∆°ng ·ª©ng trong danh s√°ch ·ªü tr√™n.\nV√≠ d·ª•:\n\nD·∫° b√™n em c√≥ m·∫´u √°o s∆° mi nam tay d√†i ƒëang ƒë∆∞·ª£c ∆∞a chu·ªông nh·∫•t ·∫° üëâ Xem t·∫°i ƒë√¢y\n\nN·∫øu kh√°ch h·ªèi ‚Äúph·ªëi ƒë·ªì‚Äù, ‚Äú√°o n√†y m·∫∑c v·ªõi qu·∫ßn g√¨‚Äù\n‚Üí Tr·∫£ l·ªùi g·ª£i √Ω phong c√°ch:\n\nD·∫° √°o s∆° mi tr·∫Øng th√¨ m√¨nh ph·ªëi v·ªõi qu·∫ßn t√¢y ƒëen ho·∫∑c qu·∫ßn kaki s√°ng m√†u ƒë·ªÅu r·∫•t sang ·∫°.\nN·∫øu anh th√≠ch phong c√°ch tr·∫ª trung th√¨ c√≥ th·ªÉ ch·ªçn √°o s∆° mi caro ph·ªëi v·ªõi qu·∫ßn jean xanh nh√©!\n\nüõçÔ∏è C√°ch ch·ªët sale\n\nN·∫øu kh√°ch n√≥i ‚Äúmu·ªën mua‚Äù, ‚Äúcho xem th√™m‚Äù, ‚Äúƒë·∫∑t h√†ng‚Äù, b·∫°n h·ªèi:\n\nD·∫° anh/ch·ªã cho em xin s·ªë ƒëi·ªán tho·∫°i ƒë·ªÉ em h·ªó tr·ª£ giao h√†ng nh√©.\n\nSau khi kh√°ch g·ª≠i s·ªë ƒëi·ªán tho·∫°i:\n\nD·∫° cho em xin ƒë·ªãa ch·ªâ nh·∫≠n h√†ng v·ªõi ·∫°.\n\nSau khi kh√°ch g·ª≠i ƒë·ªãa ch·ªâ:\n\nD·∫° anh/ch·ªã mu·ªën ƒë·∫∑t m·∫•y c√°i √°o ·∫°?\n\nSau khi ƒë·ªß th√¥ng tin:\n\nD·∫° em ghi nh·∫≠n ƒë∆°n h√†ng r·ªìi ·∫°:\n\nS·∫£n ph·∫©m: ‚Ä¶\n\nS·ªë l∆∞·ª£ng: ‚Ä¶\n\nƒê·ªãa ch·ªâ: ‚Ä¶\n\nS·ªë ƒëi·ªán tho·∫°i: ‚Ä¶\nB√™n em s·∫Ω giao h√†ng trong 24h n·ªôi th√†nh, ho·∫∑c 2‚Äì3 ng√†y t·ªânh kh√°c nha anh/ch·ªã!\n\nüìû Th√¥ng tin c·ª≠a h√†ng\n\nC·ª≠a h√†ng Th·ªùi Trang Nam ƒê·ª©c Huy\nƒê·ªãa ch·ªâ: 26/46/2A, ƒë∆∞·ªùng s·ªë 7, P3, G√≤ V·∫•p\nHotline: 0378 79 39 69 - 0978 16 94 96\nEmail: thoitrangnam.duchuy@gmail.com\n\nGi·ªù l√†m vi·ªác: 8h ‚Äì 20h (c·∫£ T7 & CN)\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        640,
        464
      ],
      "id": "3cd26508-4275-4524-bf1e-527b325fdb0b",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        544,
        704
      ],
      "id": "4016979c-40b3-43ec-959f-3540e3dc4876",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "GalKRUKkED3gQn2t",
          "name": "OpenAi account 9"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "EVENT_RECEIVED",
        "options": {
          "responseCode": 200
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.2,
      "position": [
        224,
        672
      ],
      "id": "384d652d-bc2a-44b6-a6e5-378ab27a152a",
      "name": "Respond to Webhook1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "5ce58185-b3cd-46ef-9241-1652912c8beb",
              "name": "senderID",
              "value": "={{ $json.body.entry[0].messaging[0].sender.id }}",
              "type": "string"
            },
            {
              "id": "2324a350-a471-41c3-8a48-17bf25c5719b",
              "name": "text",
              "value": "={{ $json.body.entry[0].messaging[0].message.text }}",
              "type": "string"
            },
            {
              "id": "10ba858d-9218-4e06-bc8f-eed8d09f9f9c",
              "name": "recipientID",
              "value": "={{ $json.body.entry[0].messaging[0].recipient.id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        224,
        464
      ],
      "id": "b1867be4-eeeb-4959-8622-5f03fdb29ef8",
      "name": "User Information"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1EGtk-KMTCQvgj5byWgtPgrE9URyVZOI5gFQPEvzdh7Y",
          "mode": "list",
          "cachedResultName": "Men-Fashion",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1EGtk-KMTCQvgj5byWgtPgrE9URyVZOI5gFQPEvzdh7Y/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1009733483,
          "mode": "list",
          "cachedResultName": "product",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1EGtk-KMTCQvgj5byWgtPgrE9URyVZOI5gFQPEvzdh7Y/edit#gid=1009733483"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.5,
      "position": [
        976,
        688
      ],
      "id": "b4ffe6a9-a878-4665-86f4-d48654a1e9ac",
      "name": "Product",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "X1LPRzEIroSbLK5Q",
          "name": "Google Sheets account 4"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "6d350a9b-c6db-4ed5-ba68-a7cc19ccb696",
              "leftValue": "={{ $json.output }}",
              "rightValue": "\"\"",
              "operator": {
                "type": "string",
                "operation": "notContains"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1184,
        464
      ],
      "id": "9b8c4250-b514-4981-8a04-816d057dca3b",
      "name": "If"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.senderID }}",
        "contextWindowLength": 100
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        752,
        704
      ],
      "id": "4b365fb4-bf77-4840-8a4f-33dee78dcf0d",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v24.0/me/messages",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer EAAQcinx4mAUBPsbUbRZC9m3OWIyZBUsa8ktIRVZB7Hivax1BodSgTffWZBO0EQbkvruEZBpRPCCp0StFyeNkIyhBynwlknV96Ci5UuNZAyYoM8WrgLcLymGx8uU7xzxzWZCrEmRchojqWM4xVdUtvkXbwV0KZAzSUU2pOB6qXOVZAAJe7KUyBmFn3iigRG3npkljbJtubwIFHYZAzDTvPIK92GXqJyPgZDZD"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\": \"{{ $('User Information').item.json.senderID }}\"\n  },\n  \"messaging_type\": \"RESPONSE\",\n  \"message\": {\n    \"text\": \"{{ $json.text }}\"\n  }\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1792,
        480
      ],
      "id": "d0cfc41e-71df-42eb-b60d-cc61267fb82c",
      "name": "Send Text Messenger"
    },
    {
      "parameters": {
        "jsCode": "let data = $input.first().json.output || '';\n\nconst imageRegex = /!\\[[^\\]]*\\]\\((https?:\\/\\/[^\\)]+)\\)/g;\nconst attachments = [];\nlet match;\n\n// L·∫∑p qua t·∫•t c·∫£ h√¨nh ·∫£nh\nwhile ((match = imageRegex.exec(data)) !== null) {\n  attachments.push({\n    type: 'image',\n    payload: { url: match[1] }\n  });\n}\n\n// X√≥a ph·∫ßn markdown ![m√¥ t·∫£ ·∫£nh], gi·ªØ l·∫°i URL\nlet text = data.replace(imageRegex, '$1').trim();\n\n// D·ªçn l·∫°i text\ntext = text.replace(/\\\\/g, '\\\\\\\\'); // Tho√°t d·∫•u \\\ntext = text.replace(/\"/g, '\\\\\"');   // Tho√°t d·∫•u \"\ntext = text.replace(/\\n/g, '\\\\n');  // Tho√°t k√Ω t·ª± xu·ªëng d√≤ng\n\nreturn {\n  text,\n  attachments\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1552,
        480
      ],
      "id": "d8fd8b44-f6f8-4a5e-a884-13eb5ae2bfc8",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "27acfa4c-77dd-4a74-8013-254545e52bdd",
              "leftValue": "={{ $('Code in JavaScript').item.json.attachments[0].payload.url }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2112,
        480
      ],
      "id": "f47463c9-aed0-4489-ac68-a9af39cf839c",
      "name": "If1"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v24.0/me/messages",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "facebookGraphApi",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\n    \"id\":\"{{ $('User Information').item.json.senderID }}\"\n  },\n  \"message\": {\n    \"attachments\":\n   {{JSON.stringify($('Code in JavaScript').item.json.attachments)}}\n  }\n} ",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2480,
        480
      ],
      "id": "bf896537-7278-41fe-be5d-075a696d5592",
      "name": "Send Photo Messenger",
      "alwaysOutputData": true,
      "credentials": {
        "facebookGraphApi": {
          "id": "97NmIvAhqebCBe0o",
          "name": "messenger"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "User Information",
            "type": "main",
            "index": 0
          },
          {
            "node": "Respond to Webhook1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "User Information": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Product": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Send Text Messenger": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Send Text Messenger",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Send Photo Messenger",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "c46b7ecb-6469-4e72-a83f-56b1779fe304",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "94a383c02457267bcc44878635a0fa02b7d3206c5479bfc8890faa812e2bbd97"
  },
  "id": "KgGRpIyTnBhlYMHT",
  "tags": []
}